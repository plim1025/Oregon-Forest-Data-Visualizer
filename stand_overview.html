<!DOCTYPE html>
<html>

<head>
    <meta charset="ISO-8859-1">
    <title>FOI overview</title>
</head>

<body>
    <div id="mapid" style="width: 1200px; height: 1000px;"></div>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
        crossorigin=""></script>
    <script src="Entire_Study_Area/Polygons/FOI_Study_Area.geojson" type="text/javascript"></script>
    <script type="text/javascript">
        
        var FOI = location.search.substring(1).split("=")[1];
       
        var mymap = L.map('mapid');
        var selectedFeature = null;

        var tiles = L.tileLayer.wms('http://imagery.oregonexplorer.info/arcgis/services/NAIP_2009/NAIP_2009_IR_WM/ImageServer/WMSServer', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            id: 'mapbox.streets'
        });

        tiles.addTo(mymap);
        stands = L.geoJson(stands, {
            style: style,
            onEachFeature: function(feature,layer){
                onEachFeature(feature,layer);
            }
        });
        stands = stands.addTo(mymap);


        var info = L.control();
        var popup = L.popup();


        if (typeof (FOI) === "undefined") {

            mymap.setView([42.97, -123.69], 13)

        } else {

            stands.eachLayer(
                function(layer){
                    
                    mymap.fitBounds(layer.getBounds());
                    
                }
            );
            //mymap.fitBounds(newBounds.getBounds())

        };

        info.onAdd = function (mymap) {
            this._div = L.DomUtil.create('div', 'info');
            this._div.style.backgroundColor ="white";
            this._div.style.opacity=1;
            this._div.style.borderColor="balck";
            this._div.style.padding="5px";
            this._div.style.opacity=0.8;
            this.update();
            return this._div;
        };

        info.update = function (props) {
            this._div.innerHTML = '<h4>FOI units SWO FOI: ' + (props ?
                '<b>' + props.OI_KEY + '</b>'
                : '<br />Click an FOI to see the tree list report');
        };

        info.addTo(mymap);

        function style(feature) {
            return {
                weight: 2,
                opacity: 1,
                color: 'yellow',
                fillOpacity: 0.2
            };
        }

        function highlightFeature(e) {
            var layer = e.target;
            var feature =layer.feature;
           // console.log(feature.porperties.id);
            layer.setStyle({
                weight: 5,
                color: 'orange',
                dashArray: '',
                fillOpacity: 0.7
            });

            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }
            FOI=feature.properties.OI_KEY 
            layer.bindPopup('<h1><a  target=_blank\ href=NewTemplate.html?FOI='+feature.properties.OI_KEY+'>' + 
                feature.properties.OI_KEY + '</a></h1>');
            selectedPolygon = feature.properties.OI_KEY
            layer.openPopup();
            info.update(layer.feature.properties);
        }

        function resetHighlight(e) {
            stands.resetStyle(e.target);
            info.update();
        }

        function zoomToFeature(e) {
            mymap.fitBounds(e.target.getBounds());
        }
        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature,
            });
        }

        mymap.attributionControl.addAttribution('Population data &copy; <a href="http://census.gov/">US Census Bureau</a>');


    </script>
</body>

</html>